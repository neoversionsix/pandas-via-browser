<!DOCTYPE html>
<html>
	<head>
		<title id="header-title"></title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<link rel="icon" type="image/png" href="./favicon.png" />
		<link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
		<script defer src="https://pyscript.net/latest/pyscript.js"></script>

		<link rel="stylesheet" href="./assets/css/examples.css" />
	</head>

	<body>
		<nav class="navbar" style="background-color: #1879ba;">
			<div class="app-header">
				<a href="/">
					<img src="./logo.png" class="logo" width="100" height="100">
				</a>
				<a class="title" id="page-title" href="" style="color: #f0ab3c;"></a>
			</div>
		</nav>

		<br />
		<div id="page-message"></div>

		<div id="pandas-source">
			<h3>Paste Data From Excel Below</h3>
			<textarea id="txt-url" rows="10" cols="50"></textarea>
			<br>
			<button type="submit" id="btn-load" class="py-button" py-click="loadFromURL()">Load Pasted Data</button>
		</div>

		<!-- <div id="pandas-repl" hidden>
			<h3>Python REPL</h3>
			<py-repl id ="pandas-repl-inner" output="pandas-output-inner">
				# Hit SHIFT + ENTER to execute example code

				# Get all closed airports in Great Britain
				df2 = df.query("type == 'closed' & iso_country == 'GB'")
				df2
			</py-repl> -->

		</div>

		<div id ="pandas-output" hidden>
			<h3>Output</h3>
			<div id="pandas-output-inner"></div>
		</div>

		<div id ="activate-code" hidden>
			<h3>Output</h3>
			<div id="activate-code-inner"></div>
		</div>

		<!-- <div id="pandas-dev-console" hidden>
			<h3>Dev Console</h3>
			<py-terminal auto></py-terminal>
		</div> -->

		

		<py-tutor>
			<py-config>
				packages = ["pandas"]
			</py-config>

			<section class="pyscript">
				<py-script>
                    import pandas as pd
                    import sys
                    import io
                    title = "Transforming Excel Data with Python in the Browser"
                    page_message = "Loads pasted excel data into a table"
                    #url = "https://raw.githubusercontent.com/datasets/airport-codes/master/data/airport-codes.csv"
                    Element("header-title").element.innerText = title
                    Element("page-title").element.innerText = title
                    Element("page-message").element.innerText = page_message
                    Element("txt-url").element.value = ""
                    
                    df = pd.DataFrame()
                    def loadFromURL(*ags, **kws):
                        global df
                        # clear dataframe & output
                        df = pd.DataFrame()
                        Element("pandas-output-inner").element.innerHTML = ""
                        
                        # Pasted Excel option
                        data = js.document.getElementById("txt-url").value
                        df = pd.read_csv(io.StringIO(data), sep='\t', header=0)
                        
                        #----------CONCAT A STRING
                        # Define the string to concatenate
                        string_to_concatenate = ".00"
                        # Concatenate the string to all elements in the dataframe
                        df = df.applymap(lambda x: str(x) + string_to_concatenate)
                        #-----------------------
                        #Element("pandas-repl").element.style.display = "block"
                        Element("pandas-output").element.style.display = "block"
                        #Element("pandas-dev-console").element.style.display = "block"
                        display (df, target="pandas-output-inner", append="False")
                    
                    # ACTIVATE CODE
                    # CCL Code List
                    ccl_code = [
                    '; USER RE-ACTIVATION SCRIPT',
                    'update into prsnl p',
                    'set p.end_effective_dt_tm = cnvtdatetime("31-DEC-2100")',
                    ', p.updt_dt_tm = cnvtdatetime(curdate,curtime3)',
                    ', p.updt_id = reqinfo->updt_id',
                    ', p.updt_cnt = p.updt_cnt + 1',
                    'where p.username = "SWAPME123"',
                    ''
                    ]
                    
                    # WRITE CODE TO STRING
                    final_activate_code_string = str('')
                    for index, row in df.iterrows():
                        # Column that has the usernames to put in the code
                        to_switch = row['USERNAME'].upper()
                        #Write to file
                        for a_row in ccl_code:
                            # REPLACE SWAPME123 with the username in each row of the code slab
                            new_row = a_row.replace('SWAPME123', to_switch)
                            final_activate_code_string = final_activate_code_string + new_row + '\n'
                    
                    Element("activate-code").element.style.display = "block"
                    #Element("pandas-dev-console").element.style.display = "block"
                    display (final_activate_code_string, target="activate-code-inner", append="False")
				</py-script>
			</section>
		</py-tutor>
	</body>
</html>